<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Клиенты</title>
    <style>
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
    </style>
    <script>

        function addPhoneField() {
            const phoneContainer = document.getElementById('phoneContainer');
            const newPhoneInput = document.createElement('input');
            newPhoneInput.type = 'text';
            newPhoneInput.name = 'clientPhone';
            newPhoneInput.placeholder = 'Введите телефон клиента';
            newPhoneInput.className = 'form-group';
            phoneContainer.appendChild(newPhoneInput);
        }

        function loadClients() {
            fetch('/api/client')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector('table tbody');
                    tbody.innerHTML = '';

                    data.forEach(client => {
                        const row = document.createElement('tr');

                        const nameCell = document.createElement('td');
                        nameCell.textContent = client.name;
                        row.appendChild(nameCell);

                        const addressCell = document.createElement('td');
                        addressCell.textContent = client.address.street;
                        row.appendChild(addressCell);

                        const phonesCell = document.createElement('td');
                        client.phones.forEach(phone => {
                            const phoneSpan = document.createElement('span');
                            phoneSpan.textContent = phone.number + ' ';
                            phonesCell.appendChild(phoneSpan);
                        });
                        row.appendChild(phonesCell);

                        tbody.appendChild(row);
                    });
                });
        }

        function submitForm() {
            const form = document.getElementById('create-form');
            const formData = new FormData(form);

            const client = {
                name: formData.get('clientName'),
                address: {
                    street: formData.get('clientAddress')
                },
                phones: []
            };

            formData.getAll('clientPhone').forEach(phone => {
                client.phones.push({ number: phone });
            });

            fetch('/api/client', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(client)
            })
                .then(response => response.json())
        }

        document.addEventListener('DOMContentLoaded', loadClients);

    </script>
</head>

<body>

<h4>Добавить клиента</h4>

<form id="create-form" onsubmit="submitForm()">
    <div class="form-group">
        <label for="clientName">Имя клиента:</label>
        <input type="text" id="clientName" name="clientName" placeholder="Введите имя клиента" required>
    </div>

    <div class="form-group">
        <label for="clientAddress">Адрес клиента:</label>
        <input type="text" id="clientAddress" name="clientAddress" placeholder="Введите адрес клиента">
    </div>

    <div class="form-group">
        <label>Телефоны клиента:</label>
        <div id="phoneContainer">
            <input type="text" name="clientPhone" placeholder="Введите телефон клиента" class="form-group">
        </div>
        <button type="button" onclick="addPhoneField()">Добавить телефон</button>
    </div>

    <button type="submit">Добавить клиента</button>
</form>
<pre id = "clientDataContainer"></pre>

<h4>Список клиентов</h4>
<table style="width: 400px">
    <thead>
    <tr>
        <th style="width: 30%;">Имя</th>
        <th style="width: 30%;">Адрес</th>
        <th style="width: 40%;">Телефоны</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
</body>
</html>
